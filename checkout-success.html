<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EloDark | Verificando Pagamento</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Orbitron:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="styles/main.css">
    <style>
        .checkout-result {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 24px
        }

        .result-card {
            text-align: center;
            max-width: 500px;
            background: var(--bg-secondary);
            border: 1px solid var(--border-glass);
            border-radius: var(--radius-xl);
            padding: 60px 40px;
            position: relative;
            overflow: hidden
        }

        .result-card.state-loading::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent), var(--cyan));
            animation: loading-bar 1.5s ease-in-out infinite alternate
        }

        @keyframes loading-bar {
            from { opacity: 0.4; transform: scaleX(0.6); transform-origin: left }
            to   { opacity: 1;   transform: scaleX(1);   transform-origin: left }
        }

        .result-card.state-success::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--green), var(--cyan))
        }

        .result-card.state-error::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--red, #f85149), var(--gold, #f0b132))
        }

        .result-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block
        }

        .result-card h1 {
            font-family: var(--font-display);
            font-size: 1.6rem;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 2px
        }

        .result-card p {
            color: var(--text-secondary);
            margin-bottom: 8px;
            line-height: 1.7
        }

        .order-id {
            font-family: var(--font-display);
            font-size: 1.1rem;
            color: var(--accent);
            margin: 20px 0
        }

        .result-actions {
            margin-top: 32px;
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap
        }

        .spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255,255,255,0.1);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 20px
        }

        @keyframes spin {
            to { transform: rotate(360deg) }
        }
    </style>
</head>

<body>
    <div class="checkout-result">
        <!-- Loading state (shown initially) -->
        <div class="result-card state-loading" id="state-loading">
            <div class="spinner"></div>
            <h1>Verificando Pagamento</h1>
            <p>Aguarde enquanto confirmamos seu pagamento com seguran√ßa...</p>
        </div>

        <!-- Success state -->
        <div class="result-card state-success" id="state-success" style="display:none">
            <span class="result-icon">üéâ</span>
            <h1>Pagamento Confirmado!</h1>
            <p>Seu pedido foi registrado com sucesso. Um booster ser√° atribu√≠do em breve.</p>
            <div class="order-id" id="order-info"></div>
            <p style="font-size:0.85rem">Voc√™ receber√° atualiza√ß√µes sobre o progresso do seu pedido.</p>
            <div class="result-actions">
                <a href="/" class="btn btn-primary">Meus Pedidos</a>
                <a href="/#pricing" class="btn btn-outline">Novo Pedido</a>
            </div>
        </div>

        <!-- Error state -->
        <div class="result-card state-error" id="state-error" style="display:none">
            <span class="result-icon" id="error-icon">‚ùå</span>
            <h1 id="error-title">Erro na Verifica√ß√£o</h1>
            <p id="error-message">N√£o foi poss√≠vel confirmar seu pagamento.</p>
            <p style="font-size:0.85rem">Se o problema persistir, entre em contato com nosso suporte.</p>
            <div class="result-actions">
                <a href="/#pricing" class="btn btn-primary">Tentar Novamente</a>
                <a href="/" class="btn btn-outline">Voltar ao In√≠cio</a>
            </div>
        </div>
    </div>

    <script>
        (async function () {
            const params = new URLSearchParams(window.location.search);
            const sessionId = params.get('session_id');
            const orderId = params.get('order_id');

            function showState(state) {
                document.getElementById('state-loading').style.display = 'none';
                document.getElementById('state-success').style.display = 'none';
                document.getElementById('state-error').style.display = 'none';
                document.getElementById('state-' + state).style.display = 'block';
                if (state === 'success') {
                    document.title = 'EloDark | Pagamento Confirmado ‚úÖ';
                } else if (state === 'error') {
                    document.title = 'EloDark | Erro no Pagamento';
                }
            }

            function showError(title, message, icon) {
                document.getElementById('error-title').textContent = title || 'Erro na Verifica√ß√£o';
                document.getElementById('error-message').textContent = message || 'N√£o foi poss√≠vel confirmar seu pagamento.';
                if (icon) document.getElementById('error-icon').textContent = icon;
                showState('error');
            }

            if (!sessionId) {
                showError(
                    'Acesso Inv√°lido',
                    'Esta p√°gina deve ser acessada ap√≥s a conclus√£o de um pagamento.',
                    'üö´'
                );
                return;
            }

            const token = localStorage.getItem('elodark_token');
            if (!token) {
                showError(
                    'Sess√£o Expirada',
                    'Fa√ßa login novamente para verificar seu pagamento.',
                    'üîí'
                );
                return;
            }

            try {
                const res = await fetch('/api/checkout/verify/' + sessionId, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const data = await res.json();

                if (!res.ok) {
                    showError('Erro na Verifica√ß√£o', data.error || 'N√£o foi poss√≠vel verificar o pagamento.');
                    return;
                }

                if (data.payment_status === 'paid') {
                    const displayId = data.order_id || orderId;
                    document.getElementById('order-info').innerHTML =
                        'Pedido #' + displayId + ' \u2014 <span style="color:var(--green)">Pago \u2705</span>';
                    showState('success');
                } else {
                    showError(
                        'Pagamento Pendente',
                        'Seu pagamento ainda n√£o foi confirmado. Verifique seu email ou tente novamente em alguns minutos.',
                        '‚è≥'
                    );
                }
            } catch (err) {
                showError(
                    'Erro de Conex√£o',
                    'N√£o foi poss√≠vel verificar o pagamento. Verifique sua conex√£o e tente novamente.'
                );
            }
        })();
    </script>
</body>

</html>
